<!doctype html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1">
    <link rel='stylesheet'
        href='wp-content/plugins/gutenberg/build/block-library/styleb3b9.css'>
    <link rel='stylesheet'
        href='wp-content/themes/hever/stylee2c1.css'>
    <style>
        body {
            --wp--preset--spacing--30: 0.67rem;
            background-color: #000000;
            color: rgb(255, 255, 255);
            overscroll-behavior: none;
            overflow-x: hidden;
            width: 100%;
            margin: 0;
        }

        .wp-block-button__link {
            border-radius: 100px;
            padding-top: var(--wp--preset--spacing--30);
            padding-bottom: var(--wp--preset--spacing--30);
        }

        p {
            font-size: 12px;
        }

        .video {
            display: none;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        select,
        button {
            background-color: #00000000;
            color: #fff;
            border: 2px solid #fff;
            border-radius: 20px;
            padding: 0 10px;
            height: 25px;
            margin: 1px;
            width: 100%;
            font-weight: normal;
            font-size: 12px;
        }

        select option {
            background-color: rgb(0, 0, 0);
        }

        #videoSelector {
            text-align: center;
            height: 25px;
            padding: 0 10px;
            font-size: 12px;
            border: 2px solid #fff;
            border-radius: 20px;
        }

        #custom-seekbar {
            height: 20px;
            border: 2px solid #fff;
            position: relative;
            max-width: 500px;
        }

        #custom-seekbar span {
            background-color: rgb(255, 255, 255);
            position: absolute;
            height: 18px;
        }

        #timeDisplay {
            text-align: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            color: white;
            display: inline;
            text-shadow:
                -1px -1px 0 #000,
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000;
            width: 100%;
            display: none;
        }

        #loadingText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            color: white;
            text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
            z-index: 10;
        }

        #currentTime,
        #totalTime {
            display: inline;
        }

        #audio-visualizer {
            position: absolute;
            top: 0;
            left: 0;
            z-index: -10;
        }

        #backgroundCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10;
        }
    </style>
</head>

<body class="singular">
    <canvas id="backgroundCanvas"></canvas>
    <main class="site-main">
        <article class="hentry entry">
            <header class="entry-header responsive-max-width">
                <h1 class="entry-title">Generative Music</h1>
            </header>
            <div class="entry-content">
                <div class="wp-block-buttons">
                    <div
                        class="wp-block-button has-custom-width wp-block-button__width-100 has-custom-font-size is-style-outline has-small-font-size">
                        <a class="wp-block-button__link has-background-color has-foreground-background-color has-text-color has-background has-link-color wp-element-button"
                            href="../index.html">Homepage</a>
                    </div>
                </div>
                <p class="has-text-align-center">Lyrics, vocals, instruments, images were
                    generated by AI. Rest done manually, audio refinements in Audition,
                    visuals in Photoshop, animations with motion graphics in After Effects,
                    video editing in Premiere Pro, downscaled with
                    Handbrake. And the UI/UX with JavasScript</p>
                <div class="controls">
                    <select id="videoSelector"></select>
                </div>
                <div class="controls">
                    <button id="prevBtn">Previous</button>
                    <button id="playBtn">Play</button>
                    <button id="nextBtn">Next</button>
                </div>
                <div class="controls">
                    <button id="loopBtn">Loop</button>
                    <button id="pauseBtn">Pause</button>
                    <button id="playAll">Play All</button>
                    <button id="stopBtn">Stop</button>
                </div>
                <div class="controls">
                    <button id="flatBtn">Flat</button>
                    <button id="bassBtn">Bass</button>
                    <button id="trebleBtn">Treble</button>
                    <button id="panningBtn">Binuaral</button>
                </div>
                <div id="custom-seekbar">
                    <span></span>
                    <div id="timeDisplay">
                        <div id="currentTime">00:00</div>/<div id="totalTime">00:00</div>
                    </div>
                    <div id="loadingText">Loading Page...</div>
                </div>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/sankh.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/nasd.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/yudh.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/brou.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/rifl.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/carv.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/apart.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/poten.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/crack.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/sands.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/drift.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/vile.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/river.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/falling.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/opposing.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/krishna.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/rain.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/ruins.mp4">
                </video>
                <video class="video"
                    preload="none">
                    <source src="wp-content/uploads/krwa.mp4">
                </video>
            </div>
        </article>
    </main>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script>
        document.addEventListener('contextmenu', event => event.preventDefault());
        const videos = document.querySelectorAll('.video');
        const videoSelector = document.getElementById('videoSelector');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const playAll = document.getElementById('playAll');
        const loopBtn = document.getElementById('loopBtn');
        const flatBtn = document.getElementById('flatBtn');
        const bassBtn = document.getElementById('bassBtn');
        const trebleBtn = document.getElementById('trebleBtn');
        const panningBtn = document.getElementById('panningBtn');
        const seekbar = document.getElementById('custom-seekbar');
        const seekbarSpan = seekbar.querySelector('span');
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const analyser = audioContext.createAnalyser();
        const canvas = document.getElementById("backgroundCanvas");
        const ctx = canvas.getContext("2d");
        let currentAudioSource;
        let playAllActive = false;
        let loopActive = false;
        let flatActive = false;
        let bassActive = false;
        let trebleActive = false;
        let bassGain = 0;
        let trebleGain = 0;
        let panningActive = false;
        let panValue = 0;
        let panDirection = 1;
        let lastTimestamp = 0;
        let panDurationInFrames = 100;
        const rawVideoNames = [
            "Sankhya",
            "Nasadiya Sukta",
            "Yudhishthir"
        ];
        const videoNames = rawVideoNames.map((name, index) => `${ index + 1 }/${ rawVideoNames.length } : ${ name }`);
        let currentIndex = 0;
        function resetAllVideos()
        {
            videos.forEach((video) =>
            {
                video.pause();
                video.currentTime = 0;
                video.style.display = 'none';
            });
        }
        function playVideo(index)
        {
            resetAllVideos();
            const video = videos[index];
            video.style.display = 'block';
            video.load();
            video.play();
            currentIndex = index;
            videoSelector.value = currentIndex;
            updateSeekbar();
            setupAudioSource(video);
            equalize();
        }
        function updateVideoSelector()
        {
            videoSelector.innerHTML = '';
            videos.forEach((video, index) =>
            {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = videoNames[index];
                videoSelector.appendChild(option);
            });
        }
        playBtn.addEventListener('click', () =>
        {
            videos[currentIndex].play();
        });
        pauseBtn.addEventListener('click', () =>
        {
            videos[currentIndex].pause();
        });
        stopBtn.addEventListener('click', () =>
        {
            videos[currentIndex].pause();
            videos[currentIndex].currentTime = 0;
            resetAllVideos();
            playAllActive = false;
            loopActive = false;
            const video = videos[0];
            video.style.display = 'block';
            video.load();
            currentIndex = 0;
            videoSelector.value = currentIndex;
        });
        videoSelector.addEventListener('change', () =>
        {
            const index = parseInt(videoSelector.value, 10);
            playVideo(index);
        });
        prevBtn.addEventListener('click', () =>
        {
            if (currentIndex > 0)
            {
                playVideo(currentIndex - 1);
            }
        });
        nextBtn.addEventListener('click', () =>
        {
            if (currentIndex < videos.length - 1)
            {
                playVideo(currentIndex + 1);
            }
        });
        playAll.addEventListener('click', () =>
        {
            playAllActive = true;
            playVideo(currentIndex);
        });
        videos.forEach((video, index) =>
        {
            video.addEventListener('ended', () =>
            {
                if (playAllActive)
                {
                    if (currentIndex < videos.length - 1)
                    {
                        playVideo(currentIndex + 1);
                    }
                    else
                    {
                        playVideo(0);
                    }
                }
            });
        });
        loopBtn.addEventListener('click', () =>
        {
            loopActive = true
            playAllActive = false;
            playVideo(currentIndex);
        });
        videos.forEach((video, index) =>
        {
            video.addEventListener('ended', () =>
            {
                if (loopActive)
                {
                    playVideo(currentIndex);
                }
            });
        });
        updateVideoSelector();
        playVideo(currentIndex);
        function updateSeekbar()
        {
            const vid = videos[currentIndex];
            const totalTimeElement = document.getElementById("totalTime");
            const currentTimeElement = document.getElementById("currentTime");
            function formatTime(seconds)
            {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${ minutes < 10 ? '0' + minutes : minutes }:${ secs < 10 ? '0' + secs : secs }`;
            }
            vid.addEventListener('loadedmetadata', function ()
            {
                totalTimeElement.textContent = formatTime(vid.duration);
            });
            vid.ontimeupdate = function ()
            {
                const percentage = (vid.currentTime / vid.duration) * 100;
                requestAnimationFrame(() =>
                {
                    $(seekbarSpan).css("width", percentage + "%");
                });
                currentTimeElement.textContent = formatTime(vid.currentTime);
            };
            $(seekbar).on("click", function (e)
            {
                var offset = $(this).offset();
                var left = (e.pageX - offset.left);
                var totalWidth = $(this).width();
                var percentage = (left / totalWidth);
                var vidTime = vid.duration * percentage;
                vid.currentTime = vidTime;
                $(seekbarSpan).css("width", percentage * 100 + "%");
            });
        }
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const audioElements = document.querySelectorAll('video');
        function setupAudioSource(video)
        {
            var mediaElement = video;
            const source = audioContext.createMediaElementSource(video);
            const panner = audioContext.createPanner();
            panner.panningModel = 'HRTF';
            panner.distanceModel = 'linear';
            panner.refDistance = 1;
            source.connect(panner);
            panner.connect(analyser);
            analyser.connect(audioContext.destination);
            var gainDb = -40.0;
            var bandSplit = [360, 3600];
            var hBand = audioContext.createBiquadFilter();
            hBand.type = "lowshelf";
            hBand.frequency.value = bandSplit[0];
            hBand.gain.value = gainDb;
            var hInvert = audioContext.createGain();
            hInvert.gain.value = -1.0;
            var mBand = audioContext.createGain();
            var lBand = audioContext.createBiquadFilter();
            lBand.type = "highshelf";
            lBand.frequency.value = bandSplit[1];
            lBand.gain.value = gainDb;
            var lInvert = audioContext.createGain();
            lInvert.gain.value = -1.0;
            source.connect(lBand);
            source.connect(mBand);
            source.connect(hBand);
            hBand.connect(hInvert);
            lBand.connect(lInvert);
            hInvert.connect(mBand);
            lInvert.connect(mBand);
            var lGain = audioContext.createGain();
            var mGain = audioContext.createGain();
            var hGain = audioContext.createGain();
            lBand.connect(lGain);
            mBand.connect(mGain);
            hBand.connect(hGain);
            var sum = audioContext.createGain();
            lGain.connect(sum);
            mGain.connect(sum);
            hGain.connect(sum);
            sum.connect(audioContext.destination);
            mediaElement.audioNodes = {
                lGain: lGain,
                mGain: mGain,
                hGain: hGain
            };
            mediaElement.audioNodes.panner = panner;
        }
        function updateAmplitude()
        {
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);
            let sum = 0;
            for (let i = 0; i < bufferLength; i++)
            {
                sum += dataArray[i];
            }
            const averageAmplitude = sum / bufferLength / 2;
            drawCircles(averageAmplitude);
        }
        function drawCircles(amplitude)
        {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const numCircles = 5;
            const maxRadius = Math.min(canvas.width, canvas.height);
            const baseRadius = maxRadius * 0.1;
            for (let i = 0; i < numCircles; i++)
            {
                const radius = baseRadius * (i + 1) + amplitude / 1;
                ctx.beginPath();
                ctx.arc(canvas.width / 2, canvas.height / 2, radius, 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(255, 255, 255, ${ (1 - i / numCircles) * 0.4 })`;
                ctx.lineWidth = 2;
                ctx.stroke();
                const triangleRadius = baseRadius * (i + 1) + amplitude / 2;
                ctx.beginPath();
                for (let j = 0; j < 3; j++)
                {
                    const angle = (j * 2 * Math.PI) / 3 - Math.PI / 2;
                    const x = canvas.width / 2 + triangleRadius * Math.cos(angle);
                    const y = canvas.height / 2 + triangleRadius * Math.sin(angle);
                    if (j === 0)
                    {
                        ctx.moveTo(x, y);
                    }
                    else
                    {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.strokeStyle = `rgba(255, 255, 255, ${ (1 - i / numCircles) * 0.4 })`;
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }
        function animate()
        {
            updateAmplitude();
            requestAnimationFrame(animate);
        }
        videos.forEach((video) =>
        {
            video.addEventListener('play', () =>
            {
                animate();
            });
        });
        window.addEventListener('resize', () =>
        {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
        document.addEventListener('click', () =>
        {
            if (audioContext.state === 'suspended')
            {
                audioContext.resume();
            }
        });
        window.onload = function ()
        {
            animate();
            document.getElementById('loadingText').style.display = 'none';
            document.getElementById('timeDisplay').style.display = 'block';
        };
        flatBtn.addEventListener('click', () =>
        {
            flatActive = true;
            bassActive = false;
            trebleActive = false;
            panningActive = false;
            stopPanning();
            equalize();
        });
        bassBtn.addEventListener('click', () =>
        {
            flatActive = false;
            bassActive = true;
            trebleActive = false;
            equalize();
        });
        trebleBtn.addEventListener('click', () =>
        {
            flatActive = false;
            bassActive = false;
            trebleActive = true;
            equalize();
        });
        function equalize()
        {
            const mediaElement = videos[currentIndex];
            if (flatActive)
            {
                bassGain = 0;
                trebleGain = 0;
                mediaElement.audioNodes.lGain.gain.value = 1.0;
                mediaElement.audioNodes.mGain.gain.value = 1.0;
                mediaElement.audioNodes.hGain.gain.value = 1.0;
            }
            if (bassActive)
            {
                bassGain = bassGain + 1.5;
                mediaElement.audioNodes.lGain.gain.value = bassGain;
                mediaElement.audioNodes.mGain.gain.value = 1.0;
                mediaElement.audioNodes.hGain.gain.value = 1.0;
            }
            if (trebleActive)
            {
                trebleGain = trebleGain + 1.5;
                mediaElement.audioNodes.lGain.gain.value = 1.0;
                mediaElement.audioNodes.mGain.gain.value = 1.0;
                mediaElement.audioNodes.hGain.gain.value = trebleGain;
            }
        }
        panningBtn.addEventListener('click', () =>
        {
            panningActive = true;
            if (panningActive)
            {
                panDurationInFrames = panDurationInFrames - 10;
                if (panDurationInFrames < 10)
                {
                    panDurationInFrames = 10
                }
                panAudio();
            }
        });
        function panAudio()
        {
            const video = videos[currentIndex];
            const panner = video.audioNodes.panner;
            if (!panner) return;
            let startTime = audioContext.currentTime;
            let endPanValue = panDirection === 1 ? 1 : -1;
            let panStep = (endPanValue - panValue) / panDurationInFrames;
            function smoothPan(timestamp)
            {
                if (panningActive)
                {
                    let elapsedTime = timestamp - lastTimestamp;
                    panValue += panStep;
                    panner.positionX.setValueAtTime(panValue, audioContext.currentTime);
                    if ((panDirection === 1 && panValue < 1) || (panDirection === -1 && panValue > -1))
                    {
                        lastTimestamp = timestamp;
                        requestAnimationFrame(smoothPan);
                    }
                    else
                    {
                        panDirection = panDirection === 1 ? -1 : 1;
                        panValue = panDirection === 1 ? -1 : 1;
                        lastTimestamp = timestamp;
                        panAudio();
                    }
                }
            }
            lastTimestamp = performance.now();
            requestAnimationFrame(smoothPan);
        }
        function stopPanning()
        {
            const video = videos[currentIndex];
            const panner = video.audioNodes.panner;
            if (panner)
            {
                panner.positionX.setValueAtTime(0, audioContext.currentTime);
            }
        }
    </script>
</body>

</html>